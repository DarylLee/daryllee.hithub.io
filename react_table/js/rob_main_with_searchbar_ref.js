var data=[{thumb_url_default:"https://yt3.ggpht.com/-T0H7xR-9iA8/AAAAAAAAAAI/AAAAAAAAAAA/VA9CSBc5Q8A/s88-c-k-no/photo.jpg",views:105689500,created_on:"2011-02-17T13:38:27Z",title:"psychicpebbles",id:"UC--BMyA2X4a9PGAo3lTuopg"},{thumb_url_default:"https://yt3.ggpht.com/-Aqz_Yc964cU/AAAAAAAAAAI/AAAAAAAAAAA/0SkTB3eIHL8/s88-c-k-no/photo.jpg",views:229121344,created_on:"2007-08-18T14:57:17Z",title:"JustKiddingFilms",id:"UC-A4oZF4AlOEdlyZWBCI0cQ"},{thumb_url_default:"https://yt3.ggpht.com/-0b9t8DHdd-8/AAAAAAAAAAI/AAAAAAAAAAA/5xlL-R1Id1M/s88-c-k-no/photo.jpg",views:25690295,created_on:"2006-07-05T08:01:16Z",title:"Blue Table Painting",id:"UC-aSLyvFLGEmNFcGomzL47w"},{thumb_url_default:"https://yt3.ggpht.com/-_9beDwBjMJ4/AAAAAAAAAAI/AAAAAAAAAAA/Jv6rGoAyoz0/s88-c-k-no/photo.jpg",views:18483830,created_on:"2012-03-02T15:51:06Z",title:"dillongoo",id:"UC-B06UJxJ20HYv15lzrm9mA"},{thumb_url_default:"https://yt3.ggpht.com/-JqTiqHU5_Hs/AAAAAAAAAAI/AAAAAAAAAAA/oGryI3Ig5U4/s88-c-k-no/photo.jpg",views:197190215,created_on:"2008-06-18T06:44:13Z",title:"MoneySavingVideos",id:"UC-dch3BP4gKHC4cec0PU1PA"},{thumb_url_default:"https://yt3.ggpht.com/-o3Zx-Zz8bwA/AAAAAAAAAAI/AAAAAAAAAAA/ZHRS7TqQd8U/s88-c-k-no/photo.jpg",views:430715,created_on:"2006-08-03T11:22:11Z",title:"SPLURT TV",id:"UC-eeciTxV2kfY6teG3Hu_dQ"},{thumb_url_default:"https://yt3.ggpht.com/-q03QTYLnRmM/AAAAAAAAAAI/AAAAAAAAAAA/6m7QYo0gRwA/s88-c-k-no/photo.jpg",views:790458,created_on:"2009-08-06T12:45:13Z",title:"Adozie",id:"UC-jDxvNUzbuFqDzRpAPbFYw"},{thumb_url_default:"https://yt3.ggpht.com/-HozDGGP43lY/AAAAAAAAAAI/AAAAAAAAAAA/IKNqSHJZ4fw/s88-c-k-no/photo.jpg",views:16371,created_on:"2011-09-11T12:04:08Z",title:"TheNoahHunt",id:"UC-m0-lV8U6imr5zC-9RMlAA"},{thumb_url_default:"https://yt3.ggpht.com/-nheWDZWkuaY/AAAAAAAAAAI/AAAAAAAAAAA/UUarZMj10wk/s88-c-k-no/photo.jpg",views:7561518,created_on:"2008-01-22T01:00:40Z",title:"Karliene",id:"UC-QCyIGEY6DzNyQOnyxIaEg"},{thumb_url_default:"https://yt3.ggpht.com/-QgxITA1sSog/AAAAAAAAAAI/AAAAAAAAAAA/-fpVz4fdImg/s88-c-k-no/photo.jpg",views:216964959,created_on:"2013-08-13T02:42:23Z",title:"RomanAtwoodVlogs",id:"UC-SV8-bUJfXjrRMnp7F8Wzw"},{thumb_url_default:"https://yt3.ggpht.com/-qaWKaxiiuDc/AAAAAAAAAAI/AAAAAAAAAAA/0EoZzkJEUMc/s88-c-k-no/photo.jpg",views:460971,created_on:"2011-05-09T03:43:36Z",title:"Donovan Dustin",id:"UC-uzRXWfXKZWHDvTCAQRfWA"},{thumb_url_default:"https://yt3.ggpht.com/-xSoc6icoyM0/AAAAAAAAAAI/AAAAAAAAAAA/WzMp9TXtYek/s88-c-k-no/photo.jpg",views:55921,created_on:"2013-11-27T03:22:11Z",title:"Tab's Gaming Pad",id:"UC-vkS8J9ovJFA7krXkbA90w"},{thumb_url_default:"https://yt3.ggpht.com/-qrD04Q_Asr0/AAAAAAAAAAI/AAAAAAAAAAA/IQmGgs75q7o/s88-c-k-no/photo.jpg",views:290726,created_on:"2011-10-12T03:13:19Z",title:"planethumanofficial",id:"UC-WMky94nwO2V0j3yWzJJ5g"},{thumb_url_default:"https://yt3.ggpht.com/-X_LNAKWmetg/AAAAAAAAAAI/AAAAAAAAAAA/dPPK1tgp6H8/s88-c-k-no/photo.jpg",views:1786129,created_on:"2010-01-24T19:43:24Z",title:"vedrim",id:"UC-zKPn4jKeg_sEYjoOFe13w"},{thumb_url_default:"https://yt3.ggpht.com/-Xjk-VC5VItM/AAAAAAAAAAI/AAAAAAAAAAA/rrBWC34Z7iA/s88-c-k-no/photo.jpg",views:7086046,created_on:"2008-06-19T03:52:00Z",title:"ABCD123toast",id:"UC04ytXliFP2zZpyFiZYvLQA"},{thumb_url_default:"https://yt3.ggpht.com/-i65yDNbvKjk/AAAAAAAAAAI/AAAAAAAAAAA/typlIFS918Q/s88-c-k-no/photo.jpg",views:23180487,created_on:"2009-09-12T11:04:24Z",title:"MattKeck",id:"UC04ZW2FS8RfUmJEa39_-JoA"},{thumb_url_default:"https://yt3.ggpht.com/-aXujGP8Dyzs/AAAAAAAAAAI/AAAAAAAAAAA/dSDxODBTGfI/s88-c-k-no/photo.jpg",views:666872,created_on:"2012-02-28T00:49:50Z",title:"Jesse Royal",id:"UC0CohPJt1XAP0sAKazrsxIQ"},{thumb_url_default:"https://yt3.ggpht.com/-dQFcuLsbK20/AAAAAAAAAAI/AAAAAAAAAAA/r9hmz7DWVSg/s88-c-k-no/photo.jpg",views:294623,created_on:"2011-05-03T05:07:35Z",title:"Corrie Hegwood",id:"UC0cuBvfn-k0mFkPI9ZeF5vA"},{thumb_url_default:"https://yt3.ggpht.com/-A_J7gPmZf-Q/AAAAAAAAAAI/AAAAAAAAAAA/n8yz1SmTU_k/s88-c-k-no/photo.jpg",views:643218,created_on:"2011-02-04T03:04:04Z",title:"laughspin",id:"UC0D3tWXruCZrBZqw0ojzqJQ"},{thumb_url_default:"https://yt3.ggpht.com/-MdLmmFh3qjo/AAAAAAAAAAI/AAAAAAAAAAA/lcGE1l_gam4/s88-c-k-no/photo.jpg",views:3106606,created_on:"2009-06-11T04:06:53Z",title:"Felicia Ricci",id:"UC0KJrVR7lOqDTkH2S2tjo5Q"}];
var clicks = {title: 0, views: 0, created_on: 0, thumb_url_default: 0};
 
/*** TABLE COLUMN HEADERS ***/
var ColumnHeaders = React.createClass({
  render: function() {
    return (
      <tr>
        <th data-value="title" onClick={this.props.onClick}>Title</th>
        <th data-value="views" onClick={this.props.onClick}>Views</th>
        <th data-value="created_on" onClick={this.props.onClick}>Created On</th>
        <th data-value="thumb_url_default" onClick={this.props.onClick}>URL</th>
      </tr>
    );
  }
});
 
/*** ROWS IN TABLE  ***/
var Rows = React.createClass({
  render: function() {
    return (
      <tbody>
        {this.props.data.map(function(row) {
          return <RowsWrapper key={row.id} data={row}/>;
        })}
      </tbody>
    );
  }
});
 
var RowsWrapper = React.createClass({
  render: function() {
    return (
    <tr>  
      <td>{this.props.data.title}</td>
      <td>{Number(this.props.data.views).toLocaleString('en')}</td>
      <td>{this.props.data.created_on}</td>
      <td><a href={this.props.data.thumb_url_default} target="_blank">{this.props.data.thumb_url_default}</a></td>
    </tr>
    );
  }
});
 
/*** TABLE ***/
var Table = React.createClass({
  render: function() {
    return (
      <table>
        <ColumnHeaders onClick={this.props.onClick} data={this.props.data} ref="c_headers"/>
        <Rows data={this.props.data} />
      </table>
    );
  }
});
 
/*** SEARCH BAR ***/
var SearchBar = React.createClass({
  render: function() {
    return (
      <div className="SearchBar">
      <p className="SearchBar">Search by Title:</p>
      <form className="SearchBar" onChange={this.props.onChange}>
        <input 
          ref="input"
          type="text" 
          placeholder="Search..." 
          value={this.props.filterText}
          onChange={this.props.onChange}
        />
      </form>
      </div>
    );
  }
});
 
/*** FILTERABLE TABLE (TOPMOST LEVEL) ***/
var FilterableTable = React.createClass({
  getInitialState: function() {
    return {
      filterText: '',
      columnClicked: 'id_ascending' 
    };
  },
  // set state according to search field 
  onChange: function(e) {
    this.setState({filterText: e.target.value});
  },
  // set state according to onClick events that bubbled up from ColumnHeaders
  onClick: function(e) { 
    var column = e.target.getAttribute("data-value");
    var dir = 'descending';
    if(++clicks[column] % 2 === 0) {
      dir = 'ascending';
    }
    
    // sort and filter 
    this.setState({
      columnClicked: [column, dir].join('_'),
      filterText: React.findDOMNode(this.refs.s_bar.refs.input).value
    });    
  },
  boundSort: function(key){ 
    var split = key.split('_');
    var dir   = split.pop();
    var type  = 'string';
    var first = this.props.data[0];
 
    key = split.join('_');
 
    var sorts = {
      number: function(a, b) {
        if(dir === 'descending') {
          return a[key] - b[key];
        }
        return b[key] - a[key];
      },
      date: function(a, b) {
        if(dir === 'descending') {
          return +new Date(a[key]) - +new Date(b[key]);
        }
        return +new Date(b[key]) - +new Date(a[key]);
      },
      string: function(a, b) {
        a = a[key].toUpperCase();
        b = b[key].toUpperCase();
 
        if(dir === 'descending') {
          if(a > b) {
            return -1;
          } else if (b > a ) {
            return 1;
          }
          return 0;
        }
 
        if(b > a) {
          return -1;
        } else if (b < a ) {
          return 1;
        }
        return 0;
      }
    };
    
    if(parseInt(first[key], 10) == first[key]) {
      type = 'number';
    } else if(!isNaN(+new Date(first[key]))) {
      type = 'date';
    }
 
    return sorts[type];
  },
  render: function() {
    var data = this.props.data;
    
    /** filter with the search bar **/
    if (this.state.filterText != "") {
      var text = this.state.filterText.trim();
      data = data.filter(function(r) {
        var regex = new RegExp(".*" + text + ".*", "i");
        return regex.test(r.title);
      })
    }
 
    data.sort(this.boundSort(this.state.columnClicked));
    
    return (
      <div id="FilterableTable">   
        <SearchBar onChange={this.onChange} ref="s_bar"/>
  	    <Table data={data} onClick={this.onClick}/>
  	  </div>
  	);
  }
});
 
// this draws to screen
React.render(
  <div>
    <h1 id="title">My Youtube Channels</h1>
    <FilterableTable data={data} />
  </div>,
  document.getElementById('app')
);